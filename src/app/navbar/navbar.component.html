<nav class="navbar">
  <div class="nav-container">
    <div class="nav-brand">
      <h2 routerLink="/">E-Commerce</h2>
    </div>
    
    <div class="nav-search">
      <input type="text" placeholder="Search products..." class="search-input">
      <button class="search-btn">ğŸ”</button>
    </div>
    
    <div class="nav-links">
      <a routerLink="/" class="nav-link">Home</a>
      <a href="#" class="nav-link">Categories</a>
      <a href="#" class="nav-link">Deals</a>
      
      <!-- Cart - Always visible but may require login for checkout -->
      <button 
        class="nav-link cart" 
        (click)="handleCartClick()"
        [title]="!isAuthenticated ? 'Login required for checkout' : 'View cart'"
      >
        ğŸ›’ Cart ({{cartCount}})
      </button>
      
      <!-- Authentication Section -->
      <div class="auth-section">
        <!-- Not Authenticated -->
        <button 
          *ngIf="!isAuthenticated" 
          (click)="navigateToLogin()" 
          class="login-btn"
        >
          Sign In
        </button>
        
        <!-- Authenticated User Menu -->
        <div 
          *ngIf="isAuthenticated" 
          class="user-menu-container"
          (click)="$event.stopPropagation()"
        >
          <button 
            class="user-menu-trigger" 
            (click)="toggleUserMenu()"
            [attr.aria-expanded]="showUserMenu"
            aria-haspopup="true"
          >
            <img 
              *ngIf="currentUser?.avatar; else defaultAvatar" 
              [src]="currentUser!.avatar" 
              [alt]="currentUser!.name + ' avatar'"
              class="user-avatar"
            >
            <ng-template #defaultAvatar>
              <div class="default-avatar">
                {{ currentUser?.name?.charAt(0)?.toUpperCase() || 'U' }}
              </div>
            </ng-template>
            <span class="user-name">{{ currentUser?.name || 'User' }}</span>
            <span class="dropdown-arrow" [class.rotated]="showUserMenu">â–¼</span>
          </button>
          
          <div class="user-dropdown" *ngIf="showUserMenu">
            <div class="user-info">
              <div class="user-name-full">{{ currentUser?.name }}</div>
              <div class="user-email">{{ currentUser?.email }}</div>
            </div>
            <hr class="dropdown-divider">
            <a href="#" class="dropdown-item">
              <span class="item-icon">ğŸ‘¤</span>
              Profile
            </a>
            <a href="#" class="dropdown-item">
              <span class="item-icon">ğŸ“¦</span>
              Orders
            </a>
            <a href="#" class="dropdown-item">
              <span class="item-icon">âš™ï¸</span>
              Settings
            </a>
            <hr class="dropdown-divider">
            <button class="dropdown-item logout-item" (click)="logout()">
              <span class="item-icon">ğŸšª</span>
              Sign Out
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Click outside to close menu -->
<div 
  *ngIf="showUserMenu" 
  class="overlay" 
  (click)="onDocumentClick($event)"
></div>